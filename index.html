<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LFJC Online Exam</title>
<style>
/* ===== BASE STYLES ===== */
:root {
  --primary-color: #4B0082;
  --secondary-color: #af82ba;
  --light-purple: #E6E6FA;
  --white: #fff;
  --black: #000;
  --success: #32CD32;
  --warning: #ff9900;
  --danger: #ff6666;
  --shadow: 0 5px 15px rgba(0,0,0,0.1);
  --transition: all 0.3s ease;
}

* {
  box-sizing: border-box;
}

body {
  font-family: "SF Pro Display", Arial, sans-serif;
  margin: 0;
  padding: 0;
  background: var(--white);
  color: var(--black);
  line-height: 1.6;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  overflow: hidden;
  width: 100vw;
  height: 100vh;
}

/* Disable right-click context menu */
body {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* ===== FULL SCREEN CONTAINERS ===== */
.full-screen-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 10000;
  overflow-y: auto;
  padding: 20px;
}

/* ACCESS DENIED - FULL SCREEN */
#accessDenied {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  text-align: center;
}

#accessDenied h1 {
  font-size: 3.5em;
  margin-bottom: 20px;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.access-card {
  background: rgba(255, 255, 255, 0.95);
  padding: 40px;
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  max-width: 600px;
  width: 90%;
  color: #333;
  margin: 20px;
}

.access-instructions {
  text-align: left;
  margin: 25px 0;
  padding: 20px;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 10px;
  border-left: 5px solid var(--primary-color);
}

.access-input-container {
  margin: 30px 0;
}

.access-code-input {
  padding: 18px 25px;
  font-size: 22px;
  border: 3px solid var(--primary-color);
  border-radius: 12px;
  width: 80%;
  max-width: 350px;
  text-align: center;
  margin: 15px 0;
  font-weight: bold;
  letter-spacing: 2px;
}

.verify-btn {
  background: linear-gradient(135deg, #4B0082 0%, #8A2BE2 100%);
  color: white;
  border: none;
  padding: 18px 45px;
  font-size: 22px;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  box-shadow: 0 10px 20px rgba(75, 0, 130, 0.4);
  margin-top: 20px;
}

.verify-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 15px 30px rgba(75, 0, 130, 0.6);
}

.verify-btn:active {
  transform: translateY(1px);
}

.access-error {
  color: #ff3333;
  margin-top: 15px;
  font-weight: bold;
  font-size: 18px;
  display: none;
  background: rgba(255, 0, 0, 0.1);
  padding: 12px;
  border-radius: 8px;
}

/* STUDENT ENTRY - FULL SCREEN */
#studentEntry {
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
}

.entry-card {
  background: white;
  padding: 50px;
  border-radius: 25px;
  box-shadow: 0 25px 80px rgba(0,0,0,0.15);
  max-width: 700px;
  width: 90%;
  margin: 20px;
}

.entry-card h1 {
  color: #4B0082;
  font-size: 2.8em;
  margin-bottom: 10px;
}

.entry-card .subtitle {
  color: #666;
  font-size: 1.2em;
  margin-bottom: 40px;
}

.student-form-group {
  display: flex;
  align-items: center;
  margin-bottom: 35px;
  width: 100%;
}

.student-form-group label {
  font-size: 1.3rem;
  font-weight: 600;
  color: var(--primary-color);
  width: 220px;
  text-align: right;
  padding-right: 25px;
}

.student-input {
  padding: 16px 20px;
  font-size: 1.2rem;
  border-radius: 12px;
  border: 2px solid var(--primary-color);
  outline: none;
  flex: 1;
  min-width: 300px;
  transition: var(--transition);
}

.student-input:focus {
  border-color: var(--primary-color);
  box-shadow: 0 0 0 4px rgba(75, 0, 130, 0.25);
}

.start-exam-btn {
  background: linear-gradient(135deg, #4B0082 0%, #8A2BE2 100%);
  color: white;
  border: none;
  padding: 20px 60px;
  font-size: 24px;
  border-radius: 15px;
  cursor: pointer;
  font-weight: 700;
  transition: all 0.3s ease;
  box-shadow: 0 12px 30px rgba(75, 0, 130, 0.4);
  margin-top: 30px;
  letter-spacing: 1px;
}

.start-exam-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 20px 40px rgba(75, 0, 130, 0.6);
}

.start-exam-btn:active {
  transform: translateY(1px);
}

/* RESUME EXAM SECTION */
#resumeExamSection {
  background: #fff3cd;
  border: 3px solid #ffc107;
  border-radius: 15px;
  padding: 25px;
  margin: 30px 0;
  text-align: center;
  display: none;
}

#resumeExamSection h3 {
  color: #856404;
  margin-bottom: 20px;
  font-size: 1.5em;
}

.resume-student-info {
  background: white;
  padding: 20px;
  border-radius: 10px;
  margin: 20px 0;
  text-align: left;
  display: inline-block;
}

.resume-options {
  display: flex;
  justify-content: center;
  gap: 25px;
  margin-top: 25px;
  flex-wrap: wrap;
}

.resume-btn {
  padding: 14px 35px;
  font-size: 18px;
  font-weight: bold;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
}

.resume-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
}

#resumeExamBtn {
  background: linear-gradient(135deg, #32CD32 0%, #228B22 100%);
  color: white;
}

#startNewBtn {
  background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
  color: white;
}

/* EXAM AREA - FULL SCREEN */
#examArea {
  display: none;
  width: 100vw;
  height: 100vh;
  flex-direction: column;
  background: white;
}

/* HEADER */
#examHeader {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  padding: 15px 30px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  box-shadow: 0 4px 20px rgba(0,0,0,0.2);
}

#stuInfo {
  font-size: 18px;
  font-weight: 600;
  flex: 1;
}

#stuQInfo {
  font-size: 22px;
  font-weight: 700;
  flex: 2;
  text-align: center;
}

#timerEl {
  font-size: 24px;
  font-weight: bold;
  background: rgba(255, 255, 255, 0.2);
  padding: 10px 20px;
  border-radius: 10px;
  min-width: 140px;
  text-align: center;
}

#timerEl.blink {
  animation: blinkTimer 1s infinite;
  background: rgba(220, 53, 69, 0.8);
}

/* QUESTION CONTAINER */
#questionContainer {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 30px;
  overflow-y: auto;
}

.question-image-container {
  width: 90%;
  max-width: 900px;
  height: 450px;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 20px 0 40px 0;
  padding: 20px;
  background: white;
  border-radius: 15px;
  border: 3px solid #E6E6FA;
  box-shadow: 0 8px 30px rgba(0,0,0,0.1);
}

.question-image {
  max-width: 100%;
  max-height: 100%;
  height: auto;
  border-radius: 10px;
  object-fit: contain;
}

/* NAVIGATION */
.navContainer {
  display: flex;
  justify-content: center;
  gap: 25px;
  padding: 25px;
  background: rgba(245, 245, 245, 0.9);
  border-top: 2px solid #E6E6FA;
}

.navBtn {
  font-size: 18px;
  padding: 15px 35px;
  border-radius: 12px;
  color: white;
  font-weight: bold;
  cursor: pointer;
  border: none;
  transition: all 0.3s ease;
  min-width: 180px;
}

.navBtn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
}

#prevBtn {
  background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
}

#markReviewBtn {
  background: linear-gradient(135deg, #ffb84d 0%, #ff9900 100%);
}

#nextBtn {
  background: linear-gradient(135deg, #1E90FF 0%, #4682B4 100%);
}

#submitBtn {
  background: linear-gradient(135deg, #c8b88a 0%, #b49e60 100%);
}

/* PALETTE */
#paletteContainer {
  display: grid;
  gap: 10px;
  margin: 20px auto;
  max-width: 95%;
  padding: 15px;
  justify-content: center;
  background: rgba(245, 245, 245, 0.9);
  border-radius: 15px;
  border: 2px solid #E6E6FA;
}

#paletteContainer button {
  width: 45px;
  height: 45px;
  border-radius: 50%;
  font-size: 16px;
  font-weight: bold;
  border: 2px solid var(--primary-color);
  background: var(--light-purple);
  color: var(--primary-color);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
}

#paletteContainer button:hover {
  transform: scale(1.1);
}

#paletteContainer button.selected {
  background: var(--success);
  color: var(--white);
  border-color: #2fa92f;
}

#paletteContainer button.reviewed {
  background: #FFD700;
  color: var(--black);
  border-color: #FFA500;
}

#paletteContainer button.current {
  border: 4px solid red;
  transform: scale(1.15);
}

/* OPTIONS */
.options-container {
  margin: 40px 0;
  display: flex;
  gap: 25px;
  justify-content: center;
  flex-wrap: wrap;
}

.optBtn {
  font-size: 20px;
  padding: 18px 35px;
  margin: 10px;
  border: 3px solid var(--primary-color);
  background: var(--white);
  border-radius: 12px;
  cursor: pointer;
  font-weight: bold;
  min-width: 100px;
  transition: all 0.3s ease;
}

.optBtn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 15px rgba(0,0,0,0.1);
}

.optBtn.selected {
  background: var(--success);
  color: var(--white);
  border-color: #2fa92f;
  transform: scale(1.05);
}

/* NUMERICAL INPUT */
.fill-blank-container {
  margin: 40px 0;
  text-align: center;
}

.fill-blank-input {
  padding: 18px 25px;
  font-size: 28px;
  border: 3px solid #4B0082;
  border-radius: 12px;
  width: 250px;
  text-align: center;
  margin: 20px;
  font-weight: bold;
}

.submit-fill-blank-btn {
  background: linear-gradient(135deg, #32CD32 0%, #228B22 100%);
  color: white;
  border: none;
  padding: 18px 35px;
  font-size: 20px;
  border-radius: 12px;
  cursor: pointer;
  font-weight: bold;
  margin-left: 20px;
}

/* NUMERICAL KEYPAD */
.numerical-keypad {
  margin: 30px auto;
  max-width: 300px;
}

.keypad-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  padding: 20px;
  background: #f8f9fa;
  border-radius: 15px;
  border: 3px solid #4B0082;
  box-shadow: 0 10px 30px rgba(75, 0, 130, 0.1);
}

.num-key-btn {
  width: 70px;
  height: 70px;
  font-size: 28px;
  font-weight: bold;
  border: 2px solid #4B0082;
  border-radius: 12px;
  background: linear-gradient(135deg, #ffffff 0%, #f0f0ff 100%);
  color: #4B0082;
  cursor: pointer;
  transition: all 0.2s ease;
}

.num-key-btn:hover {
  background: linear-gradient(135deg, #f0f0ff 0%, #e6e6fa 100%);
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(75, 0, 130, 0.2);
}

.num-key-btn:active {
  transform: translateY(1px);
}

/* SUMMARY AND REVIEW AREAS */
#summaryArea, #reviewArea {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  display: none;
  flex-direction: column;
  background: white;
  z-index: 10001;
  overflow-y: auto;
}

.area-header {
  text-align: center;
  padding: 30px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  margin-bottom: 30px;
}

.area-header h2 {
  font-size: 2.5em;
  margin-bottom: 15px;
}

/* ERROR MESSAGES */
.error-message {
  color: #ff3333;
  font-weight: 600;
  padding: 15px;
  margin: 15px 0;
  border-radius: 8px;
  background: rgba(255, 102, 102, 0.1);
  border: 2px solid #ff6666;
  animation: blinkRed 1s infinite;
}

/* ANIMATIONS */
@keyframes blinkTimer {
  0% { background: rgba(220, 53, 69, 0.8); }
  50% { background: rgba(255, 255, 255, 0.2); }
  100% { background: rgba(220, 53, 69, 0.8); }
}

@keyframes blinkRed {
  0% { opacity: 1; }
  50% { opacity: 0.6; }
  100% { opacity: 1; }
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* SECURITY OVERLAYS */
#violationWarningOverlay {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(255, 0, 0, 0.95);
  color: white;
  padding: 40px 60px;
  border-radius: 20px;
  z-index: 10002;
  text-align: center;
  font-weight: bold;
  font-size: 24px;
  border: 5px solid white;
  box-shadow: 0 0 60px red;
  animation: pulse 1s infinite;
  max-width: 80%;
}

#fullscreen-warning-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.95);
  backdrop-filter: blur(20px);
  z-index: 2147483646;
  display: none;
  justify-content: center;
  align-items: center;
  color: white;
  text-align: center;
}

/* POWER LOSS RECOVERY */
#powerLossRecoveryOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.95);
  z-index: 99999;
  display: none;
  justify-content: center;
  align-items: center;
  color: white;
  text-align: center;
}

#powerLossRecoveryBox {
  background: linear-gradient(135deg, #1a1a2e 0%, #162447 100%);
  padding: 50px;
  border-radius: 25px;
  max-width: 700px;
  width: 90%;
  border: 4px solid #4B0082;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
}

/* RESPONSIVE */
@media (max-width: 768px) {
  .student-form-group {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .student-form-group label {
    text-align: left;
    width: 100%;
    margin-bottom: 10px;
    padding-right: 0;
  }
  
  .student-input {
    min-width: 100%;
  }
  
  .navContainer {
    flex-wrap: wrap;
  }
  
  .navBtn {
    min-width: 150px;
    margin: 5px;
  }
  
  .access-card, .entry-card {
    padding: 30px 20px;
  }
  
  #accessDenied h1 {
    font-size: 2.5em;
  }
  
  .access-code-input {
    width: 95%;
    font-size: 20px;
  }
  
  .verify-btn, .start-exam-btn {
    padding: 15px 30px;
    font-size: 20px;
  }
  
  .question-image-container {
    height: 350px;
  }
  
  .num-key-btn {
    width: 55px;
    height: 55px;
    font-size: 22px;
  }
}

@media (max-width: 480px) {
  .full-screen-container {
    padding: 10px;
  }
  
  .access-card, .entry-card {
    padding: 20px 15px;
    margin: 10px;
  }
  
  .student-form-group label {
    font-size: 1.1rem;
  }
  
  .student-input {
    font-size: 1rem;
    padding: 14px;
  }
  
  .navBtn {
    font-size: 16px;
    padding: 12px 20px;
    min-width: 130px;
  }
  
  .optBtn {
    font-size: 18px;
    padding: 15px 25px;
    min-width: 80px;
  }
  
  .question-image-container {
    height: 280px;
  }
  
  #paletteContainer button {
    width: 35px;
    height: 35px;
    font-size: 14px;
  }
}
</style>
</head>

<body>

<!-- Power Loss Recovery Overlay -->
<div id="powerLossRecoveryOverlay">
  <div id="powerLossRecoveryBox">
    <h2 style="color: #8A2BE2; font-size: 32px; margin-bottom: 30px;">‚ö° EXAM RECOVERY AVAILABLE</h2>
    
    <div class="recovery-details" style="background: rgba(255, 255, 255, 0.1); padding: 25px; border-radius: 15px; margin: 25px 0; text-align: left;">
      <p id="recoveryStudentName" style="font-size: 18px; margin: 12px 0;"><strong>Student:</strong> Loading...</p>
      <p id="recoveryLastSave" style="font-size: 18px; margin: 12px 0;"><strong>Last Save:</strong> Loading...</p>
      <p id="recoveryProgress" style="font-size: 18px; margin: 12px 0;"><strong>Progress:</strong> Loading...</p>
      <p id="recoveryTimeLeft" style="font-size: 18px; margin: 12px 0;"><strong>Time Remaining:</strong> Loading...</p>
    </div>
    
    <div class="recovery-progress" style="margin: 30px 0; padding: 20px; background: rgba(75, 0, 130, 0.2); border-radius: 15px;">
      <p style="font-size: 18px;"><strong>Recovery Status:</strong> <span id="recoveryStatus" style="color: #32CD32;">Checking data...</span></p>
      <div class="progress-bar" style="width: 100%; height: 15px; background: #333; border-radius: 8px; margin: 15px 0; overflow: hidden;">
        <div class="progress-fill" id="recoveryProgressBar" style="height: 100%; background: linear-gradient(90deg, #4B0082, #8A2BE2); border-radius: 8px; transition: width 0.3s ease; width: 0%"></div>
      </div>
    </div>
    
    <div class="recovery-options" style="display: flex; justify-content: center; gap: 25px; margin-top: 40px; flex-wrap: wrap;">
      <button id="resumeExamRecoveryBtn" class="resume-btn" style="background: linear-gradient(135deg, #32CD32 0%, #228B22 100%); color: white; padding: 15px 40px; font-size: 18px; border: none; border-radius: 12px; cursor: pointer;">‚úÖ RESUME EXAM</button>
      <button id="discardExamRecoveryBtn" class="resume-btn" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; padding: 15px 40px; font-size: 18px; border: none; border-radius: 12px; cursor: pointer;">üóëÔ∏è START FRESH</button>
    </div>
    
    <p style="margin-top: 30px; font-size: 16px; color: #aaa;">
      <em>Your exam progress was automatically saved. You can resume where you left off.</em>
    </p>
  </div>
</div>

<!-- Full Screen Access Denied -->
<div id="accessDenied" class="full-screen-container">
    <h1>LFJC ONLINE EXAMINATION</h1>
    <p style="font-size: 1.5em; margin: 10px 0; color: white;">TOTAL 75 QUESTIONS</p>
    <p style="margin: 5px 0; font-size: 1.2em; color: rgba(255,255,255,0.9);">‚Ä¢ Maths: 20 (MCQ), 5 (Numerical Input)</p>
    <p style="margin: 5px 0; font-size: 1.2em; color: rgba(255,255,255,0.9);">‚Ä¢ Physics: 20 (MCQ), 5(Numerical Input)</p>
    <p style="margin: 5px 0; font-size: 1.2em; color: rgba(255,255,255,0.9);">‚Ä¢ Chemistry: 20 (MCQ), 5 (Numerical Input)</p>
    <p style="margin: 15px 0; font-weight: bold; font-size: 1.3em; color: #FFD700;">CORRECT ANSWER + 4 MARKS</p>
    <p style="margin: 5px 0; font-weight: bold; font-size: 1.3em; color: #FF6B6B;">WRONG ANSWER -1 MARK</p>
    
    <div class="access-card">
        <h3 style="color: #4B0082; margin-bottom: 20px; font-size: 1.8em;">üìù EXAM INSTRUCTIONS</h3>
        <div class="access-instructions">
            <p style="margin: 10px 0;">‚Ä¢ <strong>3-hour time limit</strong> - Timer shown in top right</p>
            <p style="margin: 10px 0;">‚Ä¢ <strong>Full-screen mode required</strong> - Cannot exit during exam</p>
            <p style="margin: 10px 0;">‚Ä¢ <strong>Tab switching prohibited</strong> - 3 violations = auto-submit</p>
            <p style="margin: 10px 0;">‚Ä¢ <strong>System shortcuts blocked</strong> - Windows/Alt keys disabled</p>
            <p style="margin: 10px 0;">‚Ä¢ <strong>Auto-save every 15 seconds</strong> - Progress saved automatically</p>
            <p style="margin: 10px 0;">‚Ä¢ <strong>Power loss recovery</strong> - Resume if browser crashes</p>
        </div>
        
        <div class="access-input-container">
            <h3 style="color: #4B0082; margin-bottom: 25px; font-size: 1.8em;">üîê ENTER ACCESS CODE</h3>
            <input type="password" id="accessCode" class="access-code-input" placeholder="Enter Access Code" autocomplete="off">
            <br><br>
            <button id="verifyAccess" class="verify-btn">VERIFY ACCESS</button>
            <div id="accessError" class="access-error">‚ùå Invalid access code. Please try again.</div>
        </div>
    </div>
</div>

<!-- Full Screen Student Entry -->
<div id="studentEntry" class="full-screen-container">
    <div class="entry-card">
        <h1>LFJC EXAM REGISTRATION</h1>
        <p class="subtitle">Please enter your details to begin the exam</p>
        
        <div class="student-form-group">
            <label for="stuName">NAME</label>
            <input type="text" id="stuName" class="student-input" placeholder="Enter your full name" autocomplete="off">
        </div>
        
        <div class="student-form-group">
            <label for="stuSection">SECTION</label>
            <input type="text" id="stuSection" class="student-input" placeholder="e.g., A, B, C" autocomplete="off">
        </div>
        
        <div class="student-form-group">
            <label for="stuRoll">ROLL NUMBER</label>
            <input type="text" id="stuRoll" class="student-input" placeholder="e.g., 001, 002" autocomplete="off">
        </div>
        
        <div class="student-form-group">
            <label for="stuAdm">ADMISSION NUMBER</label>
            <input type="text" id="stuAdm" class="student-input" placeholder="e.g., 2025001" autocomplete="off">
        </div>
        
        <!-- Resume Exam Section -->
        <div id="resumeExamSection">
            <h3>üîÑ Exam In Progress Found</h3>
            <div class="resume-student-info">
                <p><strong>Student:</strong> <span id="resumeStudentName">Loading...</span></p>
                <p><strong>Section:</strong> <span id="resumeSection">Loading...</span></p>
                <p><strong>Progress:</strong> <span id="resumeProgress">Loading...</span></p>
                <p><strong>Time Left:</strong> <span id="resumeTimeLeft">Loading...</span></p>
            </div>
            <p style="margin-bottom: 20px;">You have an exam in progress from a previous session.</p>
            <div class="resume-options">
                <button id="resumeExamBtn" class="resume-btn">Continue Exam</button>
                <button id="startNewBtn" class="resume-btn">Start New Exam</button>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button id="stuStartBtn" class="start-exam-btn">START EXAM</button>
            <p id="studentMsg" style="margin-top: 20px; color: #666;"></p>
            <div id="errorMessages" style="margin-top: 25px;"></div>
        </div>
    </div>
</div>

<!-- Full Screen Exam Area -->
<div id="examArea">
  <div id="examHeader">
    <div id="stuInfo"></div>
    <div id="stuQInfo"></div>
    <div>
        <span id="timerEl">üïí 00:00</span>
    </div>
  </div>

  <div id="questionContainer" style="text-align:center;margin-top:10px;"></div>

  <div class="navContainer">
    <button class="navBtn" id="prevBtn">‚¨Ö Previous</button>
    <button class="navBtn" id="markReviewBtn">Review</button>
    <button class="navBtn" id="nextBtn">Next ‚û°</button>
    <button class="navBtn" id="submitBtn">Submit Exam</button>
  </div>

  <div id="paletteContainer"></div>
</div>

<!-- Summary Area -->
<div id="summaryArea">
  <div class="area-header">
    <h2>üìä Exam Summary - <span id="summaryStudentName"></span></h2>
    <div style="font-size: 1.2em;">
      <b>Section:</b> <span id="summarySection"></span> | 
      <b>Roll:</b> <span id="summaryRoll"></span> | 
      <b>Admission No:</b> <span id="summaryAdm"></span>
    </div>
  </div>
  
  <div id="summaryTableContainer" style="overflow-x:auto;display:flex;justify-content:center;width:100%;padding: 20px;"></div>
  
  <div style="text-align:center; margin:40px 0;">
    <div id="autoTransitionMessage" class="auto-transition-message" style="display:none; background: #d4edda; border: 2px solid #c3e6cb; color: #155724; padding: 20px; border-radius: 12px; margin: 30px auto; max-width: 600px; font-size: 18px;">
      üîÑ Auto-transitioning to detailed solutions in <span id="countdown">5</span> seconds...
    </div>
    <button id="closeSummaryBtn" class="navBtn" style="background:linear-gradient(135deg, #dc3545 0%, #c82333 100%); padding: 15px 40px; font-size: 18px;">Close</button>
  </div>
</div>

<!-- Review Area -->
<div id="reviewArea">
  <div class="area-header">
    <h2>üìù Detailed Solutions - <span id="reviewStudentName"></span></h2>
    <div style="font-size: 1.2em;">
      <b>Section:</b> <span id="reviewSection"></span> | 
      <b>Roll:</b> <span id="reviewRoll"></span> | 
      <b>Admission No:</b> <span id="reviewAdm"></span>
    </div>
  </div>
  
  <!-- Results Table -->
  <div id="detailedResultsContainer" style="overflow-x:auto;display:flex;justify-content:center;width:100%;margin:30px 0;padding: 0 20px;"></div>
  
  <!-- Download Section -->
  <div id="downloadSection" class="download-section" style="text-align:center; margin:40px 0; padding: 30px; background: #f8f9fa; border-radius: 15px; border: 2px solid #e9ecef; max-width: 800px; margin: 30px auto;">
    <h4 style="color: #4B0082; margin-bottom: 20px; font-size: 1.5em;">üì• Download Your Answer Sheet</h4>
    <button onclick="downloadStudentCSV()" class="download-btn" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 18px 45px; font-size: 20px; border: none; border-radius: 12px; cursor: pointer; margin: 15px;">
      üíæ Download Complete Answer Sheet (CSV)
    </button>
    <p style="margin-top: 20px; color: #6c757d; font-size: 16px;">
      <small>Contains all your answers in original question order (Q1, Q2, Q3...). Perfect for analysis in Excel.</small>
    </p>
  </div>
  
  <!-- Detailed Solutions Container -->
  <div id="reviewQuestionsContainer" style="padding: 0 30px 50px 30px;"></div>
  
  <div style="text-align:center; margin:40px 0;">
    <button id="closeReviewBtn" class="navBtn" style="background:linear-gradient(135deg, #dc3545 0%, #c82333 100%); padding: 15px 40px; font-size: 18px;">Close</button>
  </div>
</div>

<footer>¬© LFJC 2025 All Rights Reserved</footer>

<!-- Security Overlays -->
<div id="fullRedOverlay"></div>
<div id="accessDeniedBox">
  <h1>ACCESS DENIED</h1>
  <button id="callAdminBtn" class="glow">Enter Password</button>
</div>

<!-- Modals -->
<div class="confirmModal" id="confirmModal">
  <div class="confirmBox">
    <p id="confirmText">Confirm?</p>
    <button id="confirmYes">Yes</button>
    <button id="confirmNo">No</button>
  </div>
</div>

<div id="adminPassModal">
  <div id="adminPassBox">
    <h3>Enter Admin Password</h3>
    <input type="password" id="adminPassInput">
    <br><br>
    <button id="adminPassSubmit">Submit</button>
  </div>
</div>

<!-- Full-screen Warning Overlay -->
<div id="fullscreen-warning-overlay">
  <div class="warning-content">
    <h2>‚ö†Ô∏è FULL-SCREEN REQUIRED</h2>
    <p style="font-size: 20px; margin-bottom: 30px;">You must enable full-screen mode to continue the exam.</p>
    <button id="enter-fullscreen-btn">Enter Full-Screen Mode</button>
  </div>
</div>

<!-- Violation Warning -->
<div id="violationWarningOverlay" style="display: none;"></div>

<script>
// ===== CONFIGURATION =====
const MARK_PER_CORRECT = 4, MARK_PER_WRONG = -1;
const EXAM_DURATION_MINUTES = 180; // 3 hours for 75 questions
const EXAM_DURATION_MS = EXAM_DURATION_MINUTES * 60 * 1000;
const STORAGE_KEY_PREFIX = "lfjc_exam_";
const MAX_QUESTIONS = 75;
const ACCESS_CODE = "lfjc2025";
const ADMIN_PASSWORD = "admin2025";
const RESUBMISSION_PASSWORD = "resubmit2025";
const RESUBMISSION_WINDOW_HOURS = 24;

// EXTERNAL ANSWER KEY CONFIGURATION
const ANSWER_KEY_URL = 'answer-key.txt'; // External file containing the key
let answerKey = []; // Will be loaded from external file
let keyLoaded = false;

// POWER LOSS PROTECTION CONFIG
const AUTO_SAVE_INTERVAL = 15; // seconds
const RECOVERY_WINDOW_HOURS = 4; // Allow recovery within 4 hours
const STORAGE_KEYS = {
    EXAM_PROGRESS: 'lfjc_exam_progress_v2',
    EXAM_METADATA: 'lfjc_exam_metadata',
    LAST_SAVE_TIME: 'lfjc_last_save',
    ANSWERS_BACKUP: 'lfjc_answers_backup',
    EXAM_STATE: 'lfjc_exam_state',
    PENDING_SUBMISSIONS: 'lfjc_pending_submissions'
};

// QUESTION STRUCTURE CONFIGURATION
const QUESTION_STRUCTURE = {
  total: 75,
  subjects: [
    { 
      name: "Physics", 
      start: 1, 
      end: 25, 
      mcqRange: [1, 20], 
      fillBlanksRange: [21, 25]
    },
    { 
      name: "Chemistry", 
      start: 26, 
      end: 50, 
      mcqRange: [26, 45], 
      fillBlanksRange: [46, 50]
    },
    { 
      name: "Maths", 
      start: 51, 
      end: 75, 
      mcqRange: [51, 70], 
      fillBlanksRange: [71, 75]
    }
  ]
};

// ===== GOOGLE FORMS CONFIG =====
const GOOGLE_FORMS = {
    'A': "https://docs.google.com/forms/d/e/1FAIpQLSe4uuphhY4-p5jdTZqxG_ZZUKAhQZF1ytyNizPXb0n3L85JIw/formResponse",
    'B': "https://docs.google.com/forms/d/e/1FAIpQLSc3JIcnUysvUtH12QWpHG9wAF4vd1NgEYqeyHwNP0UEkPqi5w/formResponse", 
    'C': "https://docs.google.com/forms/d/e/1FAIpQLScqYdTGoD4l0jJvzYw0tdBNRSMPepnGtOOowOXYwDFov43KHg/formResponse",
    'D': "https://docs.google.com/forms/d/e/1FAIpQLSfjAyDlY-5BAF5rPvzQS0AeTI6Vs2Rkri0V6_miA0mRivZAEg/formResponse",
    'E': "https://docs.google.com/forms/d/e/1FAIpQLSfK6Skl6Uxj8VyGnhhqfdPHcJ8mbcgpzIKLpWFElzdeQSKMgA/formResponse",
    'F': "https://docs.google.com/forms/d/e/1FAIpQLSeP-Gx2XnUg_Q17asOOeYzkoGtLykVIcQ2W006YTqTpE7xY6g/formResponse",
    'G': "https://docs.google.com/forms/d/e/1FAIpQLSe1vg_I5XR3ljr-UNFi-MXxUgjdTDyrVbHxqi_dkvtmYGUTEA/formResponse",
    'H': "https://docs.google.com/forms/d/e/1FAIpQLScyv8cps4StN2UXrsXqNdLu5UBR7t0Vwk8WSnynU2tvracs1g/formResponse",
    'I': "https://docs.google.com/forms/d/e/1FAIpQLSeyen2hSdhRwztpWnH6lyuL91ZROqwDMKIaa4gN_e-Xvyvb_g/formResponse",
    'J': "https://docs.google.com/forms/d/e/1FAIpQLSelbDi1n1EKWu7G0I92hTML6vWUO2c55p2dqrEOQ7cWflaSNg/formResponse"
};

const COMMON_FIELDS = {
    STUDENT_NAME: "entry.217666919",
    SECTION: "entry.2006392966", 
    ROLL_NUMBER: "entry.547275105",
    ADMISSION_NUMBER: "entry.1234063852",
    MATHS_MARKS: "entry.1989859216",
    PHYSICS_MARKS: "entry.1953974928", 
    CHEMISTRY_MARKS: "entry.296331194",
    TOTAL_MARKS: "entry.1289040887",
    TIMESTAMP: "entry.2139100252"
};

const ANSWERS_FIELDS = {
    'A': "entry.224183536",
    'B': "entry.2135062491",
    'C': "entry.66262823",
    'D': "entry.762314240",
    'E': "entry.109746612",
    'F': "entry.813348755",
    'G': "entry.1184321804",
    'H': "entry.64526224",
    'I': "entry.1618336199",
    'J': "entry.1279707071"
};

// ===== GLOBAL VARIABLES =====
let images = [];
let hasSubmitted = false;
let examStartTime = null;
let waitingTimerInterval = null;
let autoTransitionTimer = null;
let examInProgress = false;
let preloadedImages = {};
let currentSubjData = null;
let adminOverrideActive = false;
let assignedForm = 'A';
let isResubmission = false;
let submissionInProgress = new Set();
let googleFormsSubmissionStatus = 'pending';
let chromeMenuBlurDetector = null;
let tabSwitchCount = 0;
let lastTabSwitchTime = 0;
let fullScreenExitTimeout = null;
let autoSaveTimer = null;
let connectionStatusElement = null;
let autoSaveIndicator = null;
let powerLossRecoveryData = null;
let resumeInProgress = false;

// ===== AUTO-CLICK SYSTEM VARIABLES =====
let autoClickInterval = null;
let keepAwakeSystem = null;

// SYSTEM LOCKDOWN VARIABLES
let systemViolations = 0;
const MAX_VIOLATIONS = 2; // Only 2 violations allowed
let lastViolationTime = 0;
let systemCheckInterval = null;
let systemLockdownDetector = null;

const subjects = ["Physics", "Chemistry", "Maths"];
let examData = {files: [], subjectNames: [], keys: [], originalOrder: [], questionTypes: []};
let progress = null, timerInterval = null;

// ===== COMPLETE SYSTEM LOCKDOWN =====
class SystemLockdownSecurity {
    constructor() {
        this.violationCount = 0;
        this.maxViolations = 2; // Only 2 violations allowed
        this.lastViolationTime = 0;
        this.systemCheckInterval = null;
        console.log('üîí COMPLETE SYSTEM LOCKDOWN INITIALIZED');
    }
    
    enable() {
        this.setupCompleteLockdown();
        this.startPeriodicChecks();
        this.violationCount = 0;
        this.lastViolationTime = 0;
        console.log('‚úÖ SYSTEM LOCKDOWN ENABLED');
        return this;
    }
    
    disable() {
        this.stopPeriodicChecks();
        console.log('üîì System Lockdown Disabled');
    }
    
    setupCompleteLockdown() {
        // Prevent ALL keyboard shortcuts that could access Windows/System
        document.addEventListener('keydown', (e) => {
            if (!examInProgress) return;
            
            const currentTime = Date.now();
            if (currentTime - this.lastViolationTime < 500) return;
            
            const key = e.key.toLowerCase();
            
            // BLOCK ALL WINDOWS/META KEYS
            if (key === 'meta' || key === 'win' || e.keyCode === 91 || e.keyCode === 92) {
                e.preventDefault();
                e.stopPropagation();
                this.handleViolation('Windows key pressed');
                return false;
            }
            
            // BLOCK ALL WINDOWS+KEY COMBINATIONS
            if (e.metaKey || e.ctrlKey) {
                // Windows + Letter combinations
                const blockedCombinations = {
                    'd': 'Windows+D (Show Desktop)',
                    'e': 'Windows+E (File Explorer)',
                    'l': 'Windows+L (Lock Computer)',
                    'm': 'Windows+M (Minimize All)',
                    'r': 'Windows+R (Run Dialog)',
                    's': 'Windows+S (Search)',
                    'tab': 'Windows+Tab (Task View)',
                    'x': 'Windows+X (Power User Menu)',
                    't': 'Windows+T (Taskbar Navigation)',
                    '1': 'Windows+1 (Taskbar Shortcut)',
                    '2': 'Windows+2 (Taskbar Shortcut)',
                    '3': 'Windows+3 (Taskbar Shortcut)',
                    '4': 'Windows+4 (Taskbar Shortcut)',
                    '5': 'Windows+5 (Taskbar Shortcut)',
                    '6': 'Windows+6 (Taskbar Shortcut)',
                    '7': 'Windows+7 (Taskbar Shortcut)',
                    '8': 'Windows+8 (Taskbar Shortcut)',
                    '9': 'Windows+9 (Taskbar Shortcut)'
                };
                
                for (let combo in blockedCombinations) {
                    if (key === combo) {
                        e.preventDefault();
                        e.stopPropagation();
                        this.handleViolation(blockedCombinations[combo]);
                        return false;
                    }
                }
            }
            
            // BLOCK ALT+TAB and ALT+ESC
            if ((key === 'tab' || key === 'escape') && e.altKey) {
                e.preventDefault();
                e.stopPropagation();
                this.handleViolation(`Alt+${e.key.toUpperCase()} (Task Switching)`);
                return false;
            }
            
            // BLOCK CTRL+ALT+DELETE
            if (key === 'delete' && e.ctrlKey && e.altKey) {
                e.preventDefault();
                e.stopPropagation();
                this.handleViolation('Ctrl+Alt+Delete (Security Menu)');
                return false;
            }
            
            // BLOCK CTRL+SHIFT+ESC (Task Manager)
            if (key === 'escape' && e.ctrlKey && e.shiftKey) {
                e.preventDefault();
                e.stopPropagation();
                this.handleViolation('Ctrl+Shift+Esc (Task Manager)');
                return false;
            }
            
            // BLOCK FUNCTION KEYS that might access system
            if (e.keyCode >= 112 && e.keyCode <= 123) { // F1-F12
                e.preventDefault();
                e.stopPropagation();
                this.handleViolation(`F${e.keyCode - 111} key (System Function)`);
                return false;
            }
            
        }, true); // Use capture phase
        
        // Prevent right-click on taskbar/system areas
        document.addEventListener('contextmenu', (e) => {
            if (!examInProgress) return;
            
            // Check if click is near bottom (where taskbar usually is)
            const screenHeight = window.innerHeight;
            const clickY = e.clientY;
            
            // If click is in bottom 5% of screen (taskbar area)
            if (clickY > screenHeight * 0.95) {
                e.preventDefault();
                e.stopPropagation();
                this.handleViolation('Right-click near taskbar area');
                return false;
            }
        }, true);
        
        // Prevent mouse leave to taskbar
        document.addEventListener('mouseleave', (e) => {
            if (!examInProgress) return;
            
            if (e.clientY <= 0 || e.clientX <= 0 || 
                e.clientX >= window.innerWidth || e.clientY >= window.innerHeight) {
                this.handleViolation('Mouse moved to taskbar/edge of screen');
            }
        });
    }
    
    startPeriodicChecks() {
        if (this.systemCheckInterval) clearInterval(this.systemCheckInterval);
        
        this.systemCheckInterval = setInterval(() => {
            if (!examInProgress) return;
            
            // Check if window lost focus without tab switch (likely taskbar)
            if (!document.hasFocus()) {
                const currentTime = Date.now();
                if (currentTime - lastTabSwitchTime > 3000) {
                    // Window lost focus but no recent tab switch - likely taskbar
                    this.handleViolation('Window focus lost to taskbar/system tray');
                }
            }
            
            // Check if full-screen is lost
            const isFullScreen = document.fullscreenElement || 
                                document.webkitFullscreenElement || 
                                document.mozFullScreenElement || 
                                document.msFullscreenElement;
            
            if (!isFullScreen && examInProgress) {
                this.handleViolation('Full-screen mode exited');
            }
            
        }, 1000);
    }
    
    stopPeriodicChecks() {
        if (this.systemCheckInterval) {
            clearInterval(this.systemCheckInterval);
            this.systemCheckInterval = null;
        }
    }
    
    handleViolation(violationType) {
        if (!examInProgress) return;
        
        const currentTime = Date.now();
        
        // Prevent counting multiple violations in rapid succession
        if (currentTime - this.lastViolationTime < 1000) {
            console.log(`Ignoring rapid violation: ${violationType}`);
            return;
        }
        
        this.lastViolationTime = currentTime;
        this.violationCount++;
        
        console.log(`üö® SYSTEM LOCKDOWN VIOLATION #${this.violationCount}: ${violationType}`);
        
        // Show warning to student
        this.showWarning(this.violationCount, violationType);
        
        // SUBMIT EXAM AFTER 2 VIOLATIONS
        if (this.violationCount >= this.maxViolations) {
            console.log('üö® 2 system violations detected - submitting exam!');
            
            // Show final warning
            this.showViolationOverlay(`
                üö® EXAM VIOLATION DETECTED
                <br><br>
                ${violationType}
                <br><br>
                <strong>2 system violations reached!</strong>
                <br>
                Submitting exam in 3 seconds...
            `, 'red');
            
            // Submit exam after delay
            setTimeout(() => {
                if (examInProgress) {
                    submitExam();
                }
            }, 3000);
        }
    }
    
    showWarning(count, violationType) {
        const messages = [
            `‚ö†Ô∏è System Access: ${violationType} (1/${this.maxViolations})`,
            `üö® 2 system violations detected! ${violationType} - Submitting exam...`
        ];
        
        const messageIndex = Math.min(count - 1, 1);
        showToast(messages[messageIndex], 'error', 5000);
        
        // Show big warning overlay for serious violations
        this.showViolationOverlay(`
            ‚ö†Ô∏è SYSTEM VIOLATION
            <br><br>
            ${violationType}
            <br><br>
            <strong>Count: ${count}/${this.maxViolations}</strong>
            <br>
            Accessing taskbar, system tray, or Windows shortcuts is prohibited!
        `, 'orange');
    }
    
    showViolationOverlay(message, color) {
        const existingOverlay = document.getElementById('violationWarningOverlay');
        if (existingOverlay) {
            existingOverlay.remove();
        }
        
        const overlay = document.createElement('div');
        overlay.id = 'violationWarningOverlay';
        overlay.innerHTML = message;
        overlay.style.display = 'block';
        
        document.body.appendChild(overlay);
        
        setTimeout(() => {
            overlay.style.opacity = '0';
            overlay.style.transition = 'opacity 0.5s ease';
            setTimeout(() => {
                if (overlay.parentNode) {
                    overlay.parentNode.removeChild(overlay);
                }
            }, 500);
        }, 5000);
    }
    
    reset() {
        this.violationCount = 0;
        this.lastViolationTime = 0;
        console.log('üîÑ System violations reset');
    }
}

// ===== KEEP-AWAKE SYSTEM =====
class KeepAwakeSystem {
    constructor() {
        this.intervals = [];
        this.wakeLock = null;
        this.videoElement = null;
    }
    
    start() {
        console.log('üîã Starting keep-awake system');
        
        // 1. Start auto-click every 30 seconds
        this.startAutoClickSystem();
        
        // 2. Add keyboard events (Shift key every 45 seconds)
        this.startKeyboardActivity();
        
        // 3. Use Wake Lock API if available
        this.startWakeLock();
        
        // 4. Silent video playback
        this.startSilentVideo();
        
        console.log('‚úÖ Keep-awake system activated');
    }
    
    startAutoClickSystem() {
        // Click every 30 seconds
        const clickInterval = setInterval(() => {
            if (!examInProgress || document.hidden) return;
            performSmartClick();
        }, 30000);
        
        this.intervals.push(clickInterval);
        
        // Do initial click
        setTimeout(() => {
            if (examInProgress) performSmartClick();
        }, 2000);
    }
    
    startKeyboardActivity() {
        // Simulate keyboard activity every 45 seconds
        const keyboardInterval = setInterval(() => {
            if (!examInProgress || document.hidden) return;
            
            try {
                // Simulate Shift key press
                const keyDown = new KeyboardEvent('keydown', {
                    key: 'Shift',
                    code: 'ShiftLeft',
                    keyCode: 16,
                    bubbles: true,
                    cancelable: true
                });
                
                const keyUp = new KeyboardEvent('keyup', {
                    key: 'Shift',
                    code: 'ShiftLeft',
                    keyCode: 16,
                    bubbles: true,
                    cancelable: true
                });
                
                document.dispatchEvent(keyDown);
                setTimeout(() => document.dispatchEvent(keyUp), 100);
                
                console.log('‚å®Ô∏è Simulated keyboard activity');
                
            } catch (error) {
                console.error('Keyboard activity error:', error);
            }
        }, 45000);
        
        this.intervals.push(keyboardInterval);
    }
    
    async startWakeLock() {
        try {
            if ('wakeLock' in navigator) {
                this.wakeLock = await navigator.wakeLock.request('screen');
                console.log('‚úÖ Wake Lock acquired');
                
                // Reacquire on visibility change
                document.addEventListener('visibilitychange', async () => {
                    if (document.visibilityState === 'visible' && examInProgress && this.wakeLock === null) {
                        try {
                            this.wakeLock = await navigator.wakeLock.request('screen');
                            console.log('üîÑ Wake lock reacquired');
                        } catch (err) {
                            console.error('Wake lock reacquisition failed:', err);
                        }
                    }
                });
            }
        } catch (err) {
            console.log('Wake Lock not available:', err.message);
        }
    }
    
    startSilentVideo() {
        try {
            // Create a 1x1 pixel video element
            this.videoElement = document.createElement('video');
            this.videoElement.style.cssText = `
                position: absolute;
                width: 1px;
                height: 1px;
                opacity: 0.001;
                pointer-events: none;
                z-index: -9999;
            `;
            
            // Create canvas stream
            const canvas = document.createElement('canvas');
            canvas.width = 2;
            canvas.height = 2;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, 2, 2);
            
            const stream = canvas.captureStream(1); // 1 FPS
            this.videoElement.srcObject = stream;
            this.videoElement.muted = true;
            this.videoElement.autoplay = true;
            this.videoElement.loop = true;
            
            document.body.appendChild(this.videoElement);
            
            // Try to play
            this.videoElement.play().catch(e => {
                console.log('Video play failed:', e);
            });
            
        } catch (error) {
            console.error('Silent video failed:', error);
        }
    }
    
    stop() {
        // Clear all intervals
        this.intervals.forEach(interval => clearInterval(interval));
        this.intervals = [];
        
        // Release wake lock
        if (this.wakeLock) {
            this.wakeLock.release();
            this.wakeLock = null;
        }
        
        // Remove video
        if (this.videoElement) {
            this.videoElement.pause();
            if (this.videoElement.parentNode) {
                this.videoElement.parentNode.removeChild(this.videoElement);
            }
            this.videoElement = null;
        }
        
        console.log('üõë Keep-awake system stopped');
    }
}

// ===== FULL-SCREEN SECURITY =====
class FullScreenSecurity {
    constructor() {
        this.isFullScreen = false;
        this.securityActive = false;
        this.retryInterval = null;
        this.maxRetryAttempts = 3;
        this.retryCount = 0;
    }
    
    async enable() {
        console.log('üîí Enabling full-screen security...');
        this.securityActive = true;
        this.setupEventListeners();
        await this.enterFullScreen();
        console.log('‚úÖ Full-screen security enabled');
        return this;
    }
    
    async enterFullScreen() {
        try {
            const elem = document.documentElement;
            
            if (elem.requestFullscreen) {
                await elem.requestFullscreen();
            } else if (elem.webkitRequestFullscreen) {
                await elem.webkitRequestFullscreen();
            } else if (elem.mozRequestFullScreen) {
                await elem.mozRequestFullScreen();
            } else if (elem.msRequestFullscreen) {
                await elem.msRequestFullscreen();
            }
            
            this.isFullScreen = true;
            this.retryCount = 0;
            console.log('‚úÖ Entered full-screen mode');
            
        } catch (err) {
            console.error('‚ùå Failed to enter full-screen:', err);
            this.showWarning();
        }
    }

    setupEventListeners() {
        document.addEventListener('fullscreenchange', () => this.handleFullscreenChange());
        document.addEventListener('webkitfullscreenchange', () => this.handleFullscreenChange());
        document.addEventListener('mozfullscreenchange', () => this.handleFullscreenChange());
        document.addEventListener('MSFullscreenChange', () => this.handleFullscreenChange());
        
        document.addEventListener('keydown', (e) => this.handleKeyDown(e));
    }
    
    handleFullscreenChange() {
        const isFs = document.fullscreenElement || 
                     document.webkitFullscreenElement || 
                     document.mozFullScreenElement || 
                     document.msFullscreenElement;
        
        this.isFullScreen = !!isFs;
        
        if (!isFs && this.securityActive && examInProgress) {
            this.showWarning();
        }
    }
    
    showWarning() {
        const warningOverlay = document.getElementById('fullscreen-warning-overlay');
        if (warningOverlay) {
            warningOverlay.style.display = 'flex';
        }
        
        // Auto-retry full-screen
        if (this.retryCount < this.maxRetryAttempts) {
            this.retryCount++;
            setTimeout(() => this.enterFullScreen(), 2000);
        }
    }
    
    handleKeyDown(e) {
        if (this.securityActive && examInProgress && e.key === 'Escape') {
            console.log('üîí Escape key pressed - blocked');
            e.preventDefault();
            e.stopPropagation();
            return false;
        }
    }
    
    disable() {
        this.securityActive = false;
        
        if (this.retryInterval) {
            clearInterval(this.retryInterval);
        }
        
        if (document.exitFullscreen) {
            document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
        } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
        } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }
        
        console.log('üîì Security system disabled');
    }
}

// Initialize security systems
const examSecurity = new FullScreenSecurity();
systemLockdownDetector = new SystemLockdownSecurity();
keepAwakeSystem = new KeepAwakeSystem();

// ===== INITIALIZATION =====
window.addEventListener('load', function() {
  console.log('üöÄ LFJC Online Exam System Starting...');
  
  // Show full-screen access page
  document.getElementById('accessDenied').style.display = 'flex';
  document.getElementById('studentEntry').style.display = 'none';
  document.getElementById('examArea').style.display = 'none';
  document.getElementById('summaryArea').style.display = 'none';
  document.getElementById('reviewArea').style.display = 'none';
  
  // Focus on access code input
  setTimeout(() => {
    document.getElementById('accessCode').focus();
  }, 500);
  
  // Initialize System Lockdown Security
  systemLockdownDetector = new SystemLockdownSecurity();
  
  // Load answer key from external file
  loadAnswerKey().then(success => {
    if (success) {
      console.log("‚úÖ External answer key loaded successfully!");
      showToast('‚úÖ System ready! Enter access code.', 'success', 3000);
    }
  });
  
  // Initialize power loss protection
  setTimeout(() => {
    initPowerLossProtection();
  }, 1000);
  
  // Setup enter full-screen button
  document.getElementById('enter-fullscreen-btn').addEventListener('click', () => {
    examSecurity.enterFullScreen();
  });
});

// ===== ACCESS CODE VERIFICATION =====
function verifyAccessCode() {
    const enteredCode = document.getElementById('accessCode').value.trim();
    const errorElement = document.getElementById('accessError');
    
    errorElement.style.display = 'none';
    
    if (enteredCode === ACCESS_CODE) {
        // Enable full-screen before showing student entry
        examSecurity.enable().then(() => {
            document.getElementById('accessDenied').style.display = 'none';
            document.getElementById('studentEntry').style.display = 'flex';
            document.getElementById('accessCode').value = '';
            document.getElementById('stuName').focus();
            showToast('‚úÖ Access granted! Please enter your details.', 'success', 3000);
        }).catch(err => {
            console.error('Failed to enable full-screen:', err);
            // Fallback: Show student entry anyway
            document.getElementById('accessDenied').style.display = 'none';
            document.getElementById('studentEntry').style.display = 'flex';
            document.getElementById('stuName').focus();
        });
    } else {
        errorElement.style.display = 'block';
        document.getElementById('accessCode').value = '';
        document.getElementById('accessCode').focus();
        document.getElementById('accessDenied').style.animation = 'shake 0.5s';
        setTimeout(() => document.getElementById('accessDenied').style.animation = '', 500);
    }
}

// ===== STUDENT VALIDATION =====
function validateStudentInputs() {
  const n = document.getElementById('stuName'), 
        s = document.getElementById('stuSection'), 
        r = document.getElementById('stuRoll'), 
        a = document.getElementById('stuAdm');
  
  if (s.value) s.value = s.value.toUpperCase();
  
  let v1 = /^[A-Za-z .]+$/.test(n.value), 
      v2 = /^[A-Za-z0-9]+$/.test(s.value),
      v3 = /^[0-9]+$/.test(r.value), 
      v4 = /^[0-9]+$/.test(a.value);
  
  n.classList.toggle('error', !v1 && n.value !== ""); 
  s.classList.toggle('error', !v2 && s.value !== "");
  r.classList.toggle('error', !v3 && r.value !== ""); 
  a.classList.toggle('error', !v4 && a.value !== "");
  
  const startBtn = document.getElementById('stuStartBtn');
  const allValid = v1 && v2 && v3 && v4 && keyLoaded;
  
  if (allValid) {
    const studentData = { name: n.value, sec: s.value, roll: r.value, adm: a.value };
    assignedForm = getAssignedForm(studentData);
    document.getElementById('stuStartBtn').style.display = "inline-block";
  } else {
    document.getElementById('stuStartBtn').style.display = "none";
  }
  
  if (!keyLoaded) showError("Answer key not loaded - exam disabled. Contact administrator.");
  
  return allValid;
}

// ===== TAB SWITCH DETECTION =====
document.addEventListener('visibilitychange', function() {
    if (document.hidden && examInProgress) {
        const currentTime = Date.now();
        
        if (currentTime - lastTabSwitchTime < 1000) {
            return;
        }
        
        lastTabSwitchTime = currentTime;
        tabSwitchCount++;
        
        console.log(`Tab switch detected: ${tabSwitchCount}/3`);
        showTabSwitchWarning(tabSwitchCount);
        
        // Also check if this might be a system tray click
        if (currentTime - lastTabSwitchTime > 2000) {
            // More than 2 seconds since last tab switch - could be system tray
            systemLockdownDetector.handleViolation('Possible system tray/taskbar click');
        }
        
        if (tabSwitchCount >= 3) {
            console.log('üö® 3 tab switches detected - submitting exam');
            setTimeout(() => {
                if (examInProgress) {
                    submitExam();
                }
            }, 3000);
        }
    }
});

// ===== EVENT LISTENERS =====
document.getElementById('verifyAccess').addEventListener('click', verifyAccessCode);
document.getElementById('accessCode').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') verifyAccessCode();
});

["stuName", "stuSection", "stuRoll", "stuAdm"].forEach(id => {
  document.getElementById(id).addEventListener("input", validateStudentInputs);
});

document.getElementById('stuStartBtn').onclick = () => { 
  if (!validateStudentInputs()) return; 
  showConfirm("Start Exam?", startWithSecurity); 
};

// ===== LOAD ANSWER KEY =====
async function loadAnswerKey() {
    try {
        console.log("üì• Loading answer key from external file...");
        
        const response = await fetch(ANSWER_KEY_URL);
        
        if (!response.ok) {
            throw new Error(`Failed to load answer key: HTTP ${response.status}`);
        }
        
        const text = await response.text();
        answerKey = parseAnswerKeyFile(text);
        
        if (answerKey.length !== 75) {
            throw new Error(`Expected 75 answers, got ${answerKey.length}. Check the answer-key.txt format.`);
        }
        
        // Validate each answer
        for (let i = 0; i < 75; i++) {
            const qNum = i + 1;
            const answer = answerKey[i];
            
            const isNumerical = 
                (qNum >= 21 && qNum <= 25) ||    // Physics numerical
                (qNum >= 46 && qNum <= 50) ||    // Chemistry numerical
                (qNum >= 71 && qNum <= 75);      // Maths numerical
            
            if (isNumerical) {
                if (!/^-?\d+(\.\d+)?$/.test(answer)) {
                    throw new Error(`Invalid numerical answer at Q${qNum}: "${answer}"`);
                }
            } else {
                if (!['A', 'B', 'C', 'D'].includes(answer)) {
                    throw new Error(`Invalid MCQ answer at Q${qNum}: "${answer}"`);
                }
            }
        }
        
        console.log("‚úÖ EXTERNAL ANSWER KEY LOADED SUCCESSFULLY!");
        keyLoaded = true;
        
        // Initialize images array
        images = [];
        for (let i = 1; i <= 75; i++) {
            images.push(`questions/${i}.png`);
        }
        
        return true;
        
    } catch (error) {
        console.error("‚ùå ERROR LOADING ANSWER KEY:", error);
        
        showError(`
            <div style="color: red; padding: 15px; border: 2px solid red; border-radius: 5px;">
                <strong>‚ùå ANSWER KEY ERROR</strong><br><br>
                ${error.message}<br><br>
                <small>Please check the answer-key.txt file format and ensure it exists.</small>
            </div>
        `);
        
        return false;
    }
}

// ===== START EXAM WITH SECURITY =====
function startWithSecurity(ok) {
  if (!ok) return;
  
  tabSwitchCount = 0;
  lastTabSwitchTime = 0;
  systemLockdownDetector.reset();
  
  const stuName = document.getElementById('stuName');
  const stuSection = document.getElementById('stuSection');
  const stuRoll = document.getElementById('stuRoll');
  const stuAdm = document.getElementById('stuAdm');

  const studentKey = `${stuName.value}|${stuSection.value}|${stuRoll.value}|${stuAdm.value}`;
  localStorage.setItem(studentKey, Date.now());
  
  prepareExamData();
  
  // Start fresh exam
  progress = {
      answers: Array(examData.files.length).fill(null),
      review: Array(examData.files.length).fill(false),
      currentIndex: 0,
      student: {name: stuName.value, sec: stuSection.value, roll: stuRoll.value, adm: stuAdm.value},
      timeLeftSec: EXAM_DURATION_MINUTES * 60
  };
  examStartTime = Date.now();

  examInProgress = true;
  
  // Hide student entry and show exam area
  document.getElementById('studentEntry').style.display = "none";
  document.getElementById('examArea').style.display = "flex";
  
  // Initialize exam
  renderQuestion(); 
  renderPalette(); 
  startTimer(); 
  updateNavButtons();
  
  // Start keep-awake system
  keepAwakeSystem.start();
  
  // Enable all security systems
  systemLockdownDetector.enable();
  
  // Start auto-save
  startAutoSaveTimer();
  
  saveExamProgress();
  
  showToast('‚úÖ Exam started! Good luck!', 'success', 3000);
}

// [Rest of your existing JavaScript functions remain the same...]
// The functions below would be your existing functions like:
// - prepareExamData()
// - renderQuestion()
// - renderPalette()
// - startTimer()
// - updateNavButtons()
// - selectOption()
// - submitExam()
// - showSummaryInterface()
// - showDetailedSolutions()
// - Power loss protection functions
// - Google Forms submission functions
// - etc.

// Note: Due to character limits, I've shown the most important parts.
// You would need to integrate your existing JavaScript functions.
</script>
</body>
</html>
